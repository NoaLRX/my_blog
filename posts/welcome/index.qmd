---
title: "Économétrie Linéaire Avancé"
author: "Le Roux Noa"
date: "2023-02-06"
categories: [Clusters]
image: "clustering.png"
---

A survey of meat consumption among college students (Clustering)

```{r}
#| echo: false
#| message: false
#| include: false
#| warning: false


# Liste des libraries----
library(plyr)
library(dbplyr)
library(readxl)
library(tidyverse)
library(ade4)
library(FactoMineR)
library(explor)
library(cluster)
library(ggplot2)
library(dendextend)
library(WeightedCluster)
library(wesanderson)
library(factoextra)
library(questionr)
library(NbClust)
library(cowplot)
library(JLutils)
library(lmtest)
#library(caret)
library(EnvStats)
```

```{r}
#| echo: false
#| message: false
#| include: false
#| warning: false
base <- read.csv2("/Users/noa/Desktop/M1/S1/ELA/BDD_ELA.csv")

cols <- c("genre","type_viande","red_conso","pq_conso","sport","e1","e2","e2_bis","e3","e3","e4","e5",
          "a1","a2","a3","a4","s1","s2","s3","s4","s5", "etude","niveau_etude","boursier","boursier_2",
          "csp1","csp2","envt_enfance","animaux_enfance","parents_vege", "amis_vege","habitat","regime",
          "imc_bis","age_bis","csp1_plus","csp2_plus")
base %<>%
  mutate_each_(funs(factor(.)),cols)
```

```{r, include=FALSE}
#| echo: false
#| message: false
#| include: false
#| warning: false
acme <-  base %>%
  select(e1,e2,e2_bis,e3,e4,e5) %>%
  MCA()

#explor::explor(acme)
res <- explor::prepare_results(acme)
```

```{r}
#| echo: false
#| message: false
#| include: false
#| warning: false
#ACM ANIMAL----
acma <- base %>%
  select(a1, a2, a3, a4) %>%
  MCA()

#explor::explor(acma)

#ACM SANTE----
acms <- base %>%
  select(s1,s3,s4,s5) %>%
  MCA()

#explor::explor(acms)

# Graphiques des valeurs propres----
peige<- fviz_eig(acme, addlabels=TRUE, main="", ylab = "Variances explained (%)",
                 barfill="palegreen4",barcolor="grey35",linecolor="black",ncp=5)+theme_classic()

peiga<- fviz_eig(acma, addlabels=TRUE, main="",ylab = "Variances explained (%)",
                 barfill="burlywood3",barcolor = "grey35",linecolor = "black",ncp=5) + theme_classic()

peigs<- fviz_eig(acms, addlabels=TRUE, main="",ylab = "Variances explained (%)",
                 barfill="royalblue3",barcolor = "grey35",linecolor = "black",ncp=5) + theme_classic()

plot_grid(peige,peiga,peigs, labels = c('Environment', 'Animal', 'Health'),ncol=3)

#Clustering----

#ENVIRONMENT
ade_e <- base %>%
  select(e1,e2,e2_bis,e3,e4,e5) %>%
  dudi.acm(scannf = FALSE) %>%
  dist.dudi() %>%
  hclust(method = "ward.D2")

#ANIMAL
ade_a <- base %>%
  select(a1,a2,a3,a4) %>%
  dudi.acm(scannf = FALSE) %>%
  dist.dudi() %>%
  hclust(method = "ward.D2")

#SANTE
ade_s <- base %>%
  select(s1,s2,s3,s4,s5) %>%
  dudi.acm(scannf = FALSE) %>%
  dist.dudi() %>%
  hclust(method = "ward.D2")

#CLUSTERS----
#CHOIX NOMBRE CLUSTER
cahe <- HCPC(acme, graph = FALSE, nb.clust = 3)
caha <- HCPC(acma, graph = FALSE, nb.clust = 3)
cahs <- HCPC(acms, graph = FALSE, nb.clust = 3)


#CLUSTERS AXE 1 ET 2----
#CLUSTER ENVIRONMENT
clust_env_1_2<- fviz_cluster(cahe,repel = TRUE,show.clust.cent = TRUE,
                         axes = c(1, 2),ylab=TRUE,
                         palette = "Tableau",ggtheme = theme_minimal(),
                         main =  "Environment")+ theme(legend.position = "none")
#CLUSTER ANIMAUX
clust_animal_1_2<- fviz_cluster(caha,repel = TRUE,show.clust.cent = TRUE,
                         axes = c(1, 2),
                         palette = "Tableau",ggtheme = theme_minimal(),
                         main = "Animal")+ theme(legend.position = "none")
#CLUSTER SANTE
clust_sante_1_2<- fviz_cluster(cahs,repel = TRUE,show.clust.cent = TRUE,
                         axes = c(1, 2),
                         palette = "Tableau",ggtheme = theme_minimal(),
                         main = "Health")+ theme(legend.position = "none")

#CLUSTERS AXE 2 ET 3----
#CLUSTER ENVIRONMENT
clust_env_2_3<- fviz_cluster(cahe,repel = TRUE,show.clust.cent = TRUE,
                         axes = c(2, 3),
                         palette = "Tableau",ggtheme = theme_minimal(),
                         main =  "Environment")+ theme(legend.position = "none")

#CLUSTER ANIMAUX
clust_animal_2_3<- fviz_cluster(caha,repel = TRUE,show.clust.cent = TRUE,
                         axes = c(2, 3),
                         palette = "Tableau",ggtheme = theme_minimal(),
                         main = "Animal")+ theme(legend.position = "none")

#CLUSTER SANTE
clust_sante_2_3<- fviz_cluster(cahs,repel = TRUE,show.clust.cent = TRUE,
                         axes = c(2, 3),
                         palette = "Tableau",ggtheme = theme_minimal(),
                         main = "Health")+ theme(legend.position = "none")

#CLUSTERS AXE 3 ET 4----
#CLUSTER ENVIRONMENT
clust_env_3_4<- fviz_cluster(cahe,repel = TRUE,show.clust.cent = TRUE,
                             axes = c(3, 4),
                             palette = "Tableau",ggtheme = theme_minimal(),
                             main =  "Environment")+ theme(legend.position = "none")

#CLUSTER ANIMAUX
clust_animal_3_4<- fviz_cluster(caha,repel = TRUE,show.clust.cent = TRUE,
                                axes = c(3, 4),
                                palette = "Tableau",ggtheme = theme_minimal(),
                                main = "")+ theme(legend.position = "none")

#CLUSTER SANTE
clust_sante_3_4<- fviz_cluster(cahs,repel = TRUE,show.clust.cent = TRUE,
                               axes = c(3, 4),
                               palette = "Tableau",ggtheme = theme_minimal(),
                               main = "")+ theme(legend.position = "none")

```

```{r}
#| echo: false
#| message: false
#| warning: false
#| error: false
#| layout-ncol: 1
#| layout-nrow: 3
#| fig-cap: 
#|   - "Environment Clusters"
#|   - "Animal Clusters"
#|   - "Health Clusters"
clust_env_1_2
clust_animal_1_2
clust_sante_1_2
```
